// Script to generate logo.png and og-default.jpg from logo.svg
import sharp from 'sharp';
import { readFileSync, mkdirSync } from 'fs';
import { dirname, join } from 'path';
import { fileURLToPath } from 'url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const publicDir = join(__dirname, '..', 'public');

// Brand colors
const PRIMARY = '#23265a';
const ACCENT = '#ed5823';

async function generateImages() {
  console.log('Generating images...\n');

  // 1. Generate logo.png (200x200 with padding)
  console.log('1. Creating logo.png...');
  const logoSvg = readFileSync(join(publicDir, 'logo.svg'));

  await sharp(logoSvg)
    .resize(400, null, { fit: 'contain' }) // Width 400, auto height
    .png()
    .toFile(join(publicDir, 'logo.png'));

  console.log('   logo.png created (400px wide)\n');

  // 2. Generate og-default.jpg (1200x630)
  console.log('2. Creating og-default.jpg...');

  // Create OG image SVG with logo centered on brand background
  const ogWidth = 1200;
  const ogHeight = 630;
  const logoWidth = 500;
  const logoX = (ogWidth - logoWidth) / 2;
  const logoY = 200;

  const ogSvg = `<?xml version="1.0" encoding="UTF-8"?>
<svg width="${ogWidth}" height="${ogHeight}" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:${PRIMARY};stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1a1d45;stop-opacity:1" />
    </linearGradient>
    <style>
      .tagline {
        font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-size: 32px;
        fill: rgba(255,255,255,0.85);
        font-weight: 500;
      }
      .accent-bar {
        fill: ${ACCENT};
      }
    </style>
  </defs>

  <!-- Background -->
  <rect width="100%" height="100%" fill="url(#bg)"/>

  <!-- Subtle pattern overlay -->
  <pattern id="pattern" patternUnits="userSpaceOnUse" width="60" height="60">
    <path d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z" fill="rgba(255,255,255,0.03)"/>
  </pattern>
  <rect width="100%" height="100%" fill="url(#pattern)"/>

  <!-- Accent bar at top -->
  <rect class="accent-bar" width="100%" height="6" y="0"/>

  <!-- Logo (white version) -->
  <g transform="translate(${logoX}, ${logoY}) scale(${logoWidth / 379.47})">
    <!-- Document icon in accent color -->
    <path fill="${ACCENT}" d="M38.04,19.34H13.56c-3.37,0-6.27,2.41-6.89,5.72L.12,60.23c-.8,4.31,2.5,8.29,6.89,8.29h24.48c3.37,0,6.27-2.41,6.89-5.72l6.55-35.17c.8-4.31-2.5-8.29-6.89-8.29ZM31.36,60.09h0c-.13.73-.77,1.26-1.51,1.26H9.97c-.96,0-1.68-.87-1.51-1.81h0c.13-.73.77-1.26,1.51-1.26h19.88c.96,0,1.68.87,1.51,1.81ZM33.28,49.5h0c-.13.73-.77,1.26-1.51,1.26H11.89c-.96,0-1.68-.87-1.51-1.81h0c.13-.73.77-1.26,1.51-1.26h19.88c.96,0,1.68.87,1.51,1.81ZM35.2,38.9c-.13.73-.77,1.26-1.51,1.26H13.81c-.96,0-1.68-.87-1.51-1.81h0c.13-.73.77-1.26,1.51-1.26h19.88c.96,0,1.68.87,1.51,1.81ZM37.12,28.31c-.13.73-.77,1.26-1.51,1.26H15.73c-.96,0-1.68-.87-1.51-1.81.13-.73.77-1.26,1.51-1.26h19.88c.96,0,1.68.87,1.51,1.81Z"/>
    <path fill="${ACCENT}" d="M57.43,43.25l-10.59-12.51-5.13,27.53,15.43-12.22c.87-.69.99-1.96.28-2.8Z"/>

    <!-- Text in white -->
    <path fill="#ffffff" d="M76.97,31.02v-8.97h29.95v8.97h-29.95ZM86.74,69.13V10.04h9.23v59.09h-9.23Z"/>
    <path fill="#ffffff" d="M110.86,69.13V22.06h9.32v14.79l-.9-3.59c.66-2.27,1.78-4.33,3.36-6.19,1.58-1.85,3.41-3.32,5.47-4.39s4.2-1.61,6.41-1.61c1.02,0,1.99.09,2.91.27.93.18,1.66.39,2.2.63l-2.42,10.04c-.72-.3-1.51-.55-2.38-.76-.87-.21-1.72-.31-2.56-.31-1.61,0-3.15.31-4.62.94-1.47.63-2.75,1.49-3.86,2.6-1.11,1.11-1.99,2.39-2.65,3.86-.66,1.47-.99,3.06-.99,4.8v26h-9.32Z"/>
    <path fill="#ffffff" d="M158.65,70.02c-3.89,0-7.43-1.08-10.62-3.23-3.2-2.15-5.75-5.08-7.67-8.79-1.91-3.71-2.87-7.89-2.87-12.55s.97-8.92,2.91-12.6c1.94-3.68,4.57-6.56,7.89-8.65,3.32-2.09,7.04-3.14,11.16-3.14,2.45,0,4.69.36,6.72,1.08,2.03.72,3.81,1.72,5.33,3,1.52,1.29,2.78,2.77,3.77,4.44.99,1.67,1.6,3.47,1.84,5.38l-2.06-.72v-12.19h9.32v47.07h-9.32v-11.21l2.15-.63c-.36,1.61-1.09,3.18-2.2,4.71-1.11,1.52-2.51,2.88-4.21,4.08-1.7,1.2-3.59,2.15-5.65,2.87-2.06.72-4.23,1.08-6.5,1.08ZM161.07,61.51c2.81,0,5.29-.69,7.44-2.06,2.15-1.37,3.84-3.27,5.07-5.69,1.22-2.42,1.84-5.18,1.84-8.29s-.61-5.77-1.84-8.16c-1.23-2.39-2.91-4.27-5.07-5.65-2.15-1.37-4.63-2.06-7.44-2.06s-5.19.69-7.31,2.06c-2.12,1.38-3.8,3.26-5.02,5.65-1.23,2.39-1.84,5.11-1.84,8.16s.61,5.87,1.84,8.29c1.22,2.42,2.9,4.32,5.02,5.69,2.12,1.38,4.56,2.06,7.31,2.06Z"/>
    <path fill="#ffffff" d="M190.6,69.13V22.06h9.32v10.04l-1.7,1.08c.48-1.55,1.24-3.05,2.29-4.48,1.05-1.43,2.33-2.7,3.86-3.81,1.52-1.11,3.17-1.99,4.93-2.65,1.76-.66,3.57-.99,5.42-.99,2.69,0,5.05.45,7.08,1.35,2.03.9,3.71,2.24,5.02,4.03,1.31,1.79,2.27,4.03,2.87,6.72l-1.43-.36.63-1.52c.66-1.37,1.57-2.67,2.73-3.9,1.17-1.22,2.5-2.32,3.99-3.27,1.49-.96,3.08-1.7,4.75-2.24,1.67-.54,3.32-.81,4.93-.81,3.53,0,6.44.72,8.74,2.15,2.3,1.43,4.03,3.62,5.2,6.54,1.17,2.93,1.75,6.58,1.75,10.94v28.24h-9.32v-27.7c0-2.69-.34-4.89-1.03-6.59-.69-1.7-1.72-2.97-3.09-3.81-1.38-.84-3.14-1.26-5.29-1.26-1.67,0-3.24.28-4.71.85-1.47.57-2.73,1.36-3.81,2.38-1.08,1.02-1.91,2.2-2.51,3.54-.6,1.34-.9,2.82-.9,4.44v28.15h-9.32v-27.88c0-2.45-.36-4.53-1.08-6.23-.72-1.7-1.76-3-3.14-3.9-1.38-.9-3.05-1.35-5.02-1.35-1.67,0-3.23.28-4.66.85-1.43.57-2.69,1.35-3.77,2.33-1.08.99-1.91,2.15-2.51,3.5-.6,1.35-.9,2.8-.9,4.35v28.33h-9.32Z"/>
    <path fill="#ffffff" d="M272.84,11.66c-1.97,0-3.5-.51-4.57-1.52-1.08-1.02-1.61-2.45-1.61-4.3,0-1.73.55-3.14,1.66-4.21,1.11-1.08,2.61-1.61,4.53-1.61s3.5.51,4.57,1.52c1.08,1.02,1.61,2.45,1.61,4.3,0,1.73-.55,3.14-1.66,4.21-1.11,1.08-2.61,1.61-4.53,1.61ZM268.36,69.13V22.06h9.23v47.07h-9.23Z"/>
    <path fill="#ffffff" d="M283.33,31.02v-8.97h29.95v8.97h-29.95ZM293.1,69.13V10.04h9.23v59.09h-9.23Z"/>
    <path fill="#ffffff" d="M323.23,11.66c-1.97,0-3.5-.51-4.57-1.52-1.08-1.02-1.61-2.45-1.61-4.3,0-1.73.55-3.14,1.66-4.21,1.11-1.08,2.61-1.61,4.53-1.61s3.5.51,4.57,1.52c1.08,1.02,1.61,2.45,1.61,4.3,0,1.73-.55,3.14-1.66,4.21-1.11,1.08-2.62,1.61-4.53,1.61ZM318.74,69.13V22.06h9.23v47.07h-9.23Z"/>
    <path fill="#ffffff" d="M353.74,70.02c-3.89,0-7.43-1.08-10.63-3.23-3.2-2.15-5.75-5.08-7.67-8.79-1.91-3.71-2.87-7.89-2.87-12.55s.97-8.92,2.91-12.6c1.94-3.68,4.57-6.56,7.89-8.65,3.32-2.09,7.04-3.14,11.16-3.14,2.45,0,4.69.36,6.72,1.08,2.03.72,3.81,1.72,5.33,3,1.52,1.29,2.78,2.77,3.77,4.44.99,1.67,1.6,3.47,1.84,5.38l-2.06-.72v-12.19h9.33v47.07h-9.33v-11.21l2.15-.63c-.36,1.61-1.09,3.18-2.2,4.71-1.11,1.52-2.51,2.88-4.21,4.08-1.7,1.2-3.59,2.15-5.65,2.87-2.06.72-4.23,1.08-6.5,1.08ZM356.16,61.51c2.81,0,5.29-.69,7.44-2.06,2.15-1.37,3.84-3.27,5.07-5.69,1.22-2.42,1.84-5.18,1.84-8.29s-.61-5.77-1.84-8.16c-1.23-2.39-2.91-4.27-5.07-5.65-2.15-1.37-4.63-2.06-7.44-2.06s-5.19.69-7.31,2.06c-2.12,1.38-3.8,3.26-5.02,5.65-1.23,2.39-1.84,5.11-1.84,8.16s.61,5.87,1.84,8.29c1.22,2.42,2.9,4.32,5.02,5.69,2.12,1.38,4.56,2.06,7.31,2.06Z"/>
  </g>

  <!-- Tagline -->
  <text x="50%" y="420" text-anchor="middle" class="tagline">
    Apostillas y tramites de documentos latinoamericanos
  </text>

  <!-- Website URL -->
  <text x="50%" y="550" text-anchor="middle" style="font-family: Inter, sans-serif; font-size: 24px; fill: rgba(255,255,255,0.6); font-weight: 400;">
    tramitia.es
  </text>
</svg>`;

  await sharp(Buffer.from(ogSvg))
    .jpeg({ quality: 90 })
    .toFile(join(publicDir, 'og-default.jpg'));

  console.log('   og-default.jpg created (1200x630)\n');

  console.log('Done! Images created in public/ folder.');
}

generateImages().catch(console.error);
